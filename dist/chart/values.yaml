# Configure the controller manager deployment
manager:
  replicas: 1
  container:
    image:
      repository: ghcr.io/clickhouse/clickhouse-operator/clickhouse-operator
      tag: v0.0.1
      pullPolicy: IfNotPresent
    args: []

  # Environment variables
  env: []

  imagePullSecrets: []

  # Pod-level security settings
  podSecurityContext:
    runAsNonRoot: true
    seccompProfile:
      type: RuntimeDefault

  # Container-level security settings
  securityContext:
    allowPrivilegeEscalation: false
    capabilities:
      drop:
        - ALL
    readOnlyRootFilesystem: true

  # Resource limits and requests
  resources:
    limits:
      cpu: 500m
      memory: 128Mi
    requests:
      cpu: 10m
      memory: 64Mi

  terminationGracePeriodSeconds: 10
  serviceAccountName: clickhouse-operator-controller-manager

# Essential RBAC permissions (required for controller operation)
# These include ServiceAccount, controller permissions, leader election, and metrics access
# Note: Essential RBAC is always enabled as it's required for the controller to function

# Helper RBAC roles for managing custom resources
# These provide convenient admin/editor/viewer roles for each CRD type
# Useful for giving users different levels of access to your custom resources
rbacHelpers:
  enable: false  # Install convenience admin/editor/viewer roles for CRDs

# Custom Resource Definitions
crd:
  enable: true  # Install CRDs with the chart
  keep: true    # Keep CRDs when uninstalling

# Controller metrics endpoint.
# Enable to expose /metrics endpoint with RBAC protection.
metrics:
  enable: true
  secure: false # Enable to use Prometheus ServiceMonitor
  port: 8080  # Metrics server port

# Cert-manager integration for TLS certificates.
# Required for webhook certificates and secure metrics endpoint certificates.
# Requires cert-manager to be installed in the cluster.
certManager:
  enable: true

# Webhook server configuration
webhook:
  enable: true
  port: 9443  # Webhook server port

# Prometheus scraping settings
prometheus:
  # Add annotations to allow Prometheus service discovery scrape metrics.
  scraping_annotations: false
  # Enable Prometheus ServiceMonitor for metrics scraping.
  # Requires prometheus-operator to be installed in the cluster.
  service_monitor: false
